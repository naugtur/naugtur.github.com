<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>My NPM package will eat your lunch</title>

    <meta name="author" content="naugtur">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.5.0/css/reveal.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.5.0/css/theme/black.css" id="theme">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.5.0/lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.5.0/css/print/pdf.css' : 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>

    <link rel="stylesheet" href="../branding/style.css" id="branding">
    <style>
        .an-container {
            width: 100%;
            height: 100%
        }

        .an-item,
        .an-start-loc {
            position: fixed;
            top: 25%;
            left: 15%;
        }

        .an-cover {
            z-index: 10;
        }

        .an-target {
            position: fixed;
            bottom: 25%;
            right: 15%;
            font-size: 2.5em !important;
        }

        .an-item {
            offset-path: path('M100,80 C200,-200 500,0 600,300');
            offset-rotate: 0deg;
        }

        .an-item.an-to {
            animation: move 3456ms infinite ease-in-out;
        }

        .an-item.an-oops {
            background-color: rgba(255, 166, 60, 0.9);

            /* animation-play-state: paused !important; */
            border-radius: 50%;
            offset-path: path('M30,80 C200,-200 500,0 300,250');
            animation: discover 3456ms ease-in-out;
            animation-fill-mode: forwards;
        }

        .an-oops:after {
            content: 'Oops!';
            position: absolute;
        }

        @keyframes move {
            0% {
                offset-distance: 0%;
            }

            100% {
                offset-distance: 100%;
            }
        }

        @keyframes discover {
            0% {
                offset-distance: 0%;
                box-shadow: 1px -2px 0px 0px rgb(255 166 60);
            }

            100% {
                box-shadow: 1px -2px 64px 50px rgb(255 166 60);
                offset-distance: 100%;
            }
        }

        .avatar {
            position: fixed;
            bottom: 3%;
            right: 15%;
            height: 100px;
        }
    </style>
</head>

<body>

    <div class="reveal none" id="naugtur">

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">
            <section data-background-image="./intro.svg">
                <br>
                <h1>My NPM package will eat your lunch</h1>
                <small>@naugtur, 2021</small>
            </section>

            <section data-markdown>
                ### So, imagine we meet for some üçª and nerding out about your new project.
            </section>
            <section data-markdown data-background-color="#3d0364">
                You say  
                ### Sounds unrealistic
                ### but cool
            </section>
            <section data-markdown>
                Then I ask
                ### How did you do this and that?
            </section>
            <section data-markdown data-background-color="#3d0364">
                ### Packages!
                #### Shoulders of giants, etc.etc.
            </section>
            <section data-markdown>
                ### npm install?
            </section>
            <section class="animatedSlide">
                <h3>npm install?</h3>

                <img src="./npm.svg" alt="npm logo" style="width: 15%; padding: 20px; background-color: #333;"
                    class="an-cover an-start-loc">
                <div class="an-target an-cover">üìÅ</div>
                <div class="an-container"></div>

            </section>
            <section data-markdown>
                #### Have you heard of
                ### Supply chain attacks?
            </section>
            <section data-markdown data-background-color="#3d0364">
                ### I know, I know
                ### But I install good stuff
            </section>

            <section class="animatedDependency">
                How about <div class="dependencies">
                    <div class="adependency"> a dependency of </div>

                </div>

                <span> a dev dependency of yours?</span>
            </section>

            <section data-markdown data-background-color="#3d0364">
                ### Well,
                ### I don't run it in production
            </section>
            <section data-markdown>
                ### U sure? ü§î
            </section>
            <section data-markdown>
                ```js
                "postinstall":
                "echo üí© > /etc/hosts"
                ```
            </section>

            <section data-markdown data-background-color="#3d0364">
                ### Well, üí©
            </section>
            <section data-markdown>
                ### Need a demo?
            </section>
            <section data-markdown data-background-color="#3d0364">
                ### Ok, wait
                ```
                ‚ú®üêã
                npm ci
                cp node_modules s3://
                üî•üî•üêãüî•üî•
                ```
                #### Gotcha! Now I'm safe!
            </section>
            <section data-markdown>
                ### Hold my üç∫
            </section>
            <section data-markdown data-background-image="./intro.svg">
                ### Hold my üç∫
            </section>
            <section data-markdown data-background-color="#3d0364">
                # üò±  


                ### Woot?!
            </section>









            <section data-markdown>
                ### I was into JS security before I knew JS or security
            </section>

            <section data-markdown>
                My first 5 lines of JavaScript ever
                ```js
                function kill(){
                setTimeout('kill',0)
                setTimeout('kill',0)
                }
                kill()
                ```

                breaks Windows pre XP SP2
            </section>
            <section data-markdown>
                ### How does one hack the typescript compiler?

                With code coverage tools!
            </section>
           
            <section data-markdown>
                #### Deep down inside
                ### I'm on the blue team
            </section>
           











            <section data-markdown>
                # Let's fix this mess
            </section>

            <section data-markdown>
                ## --ignore-scripts

                ```
                npm ci --ignore-scripts
                yarn --ignore-scripts
                ```
            </section>

            <section data-markdown data-background-color="#3d0364">
                ### Ok.
                ### that's all?
            </section>

            <section data-markdown>
                ### Almost...
            </section>
            <section data-markdown>
                ## üòÖ
                #### Does your app still work?  
                
                #### Some scripts are there for a reason 
            </section>
            <section data-markdown>
                #### Run selected scritps
                npm CLI has an option to do that
                ```
                npm rebuild bcrypt bignum
                ```
                For more control (and yarn support)  
                use allow-scripts
                ```
                npm install --save-dev allow-scripts
                ```
            </section>
            <section>
                <h3>allow scripts</h3>
                <img src="dom.png" class="avatar">
                <img src="allow.png" alt="allow-scripts npm page screenshot">
                
            </section>
            <section>
                <h3>more tooling?</h3>
                <div>
                    @lavamoat/allow-scripts etc.
                </div>
                <img src="kumavis.png" class="avatar">
                <img src="lavamoat-logo.png" alt="lavamoat logo">

            </section>
            <section data-markdown data-background-color="#3d0364">
                ### That's great.
                 Now I just need to create the allow list   
                 with a lot of trial and error...
            </section>
            <section data-markdown>
                # Nope!
                </section>

                <section>
                    <h3>There's an app for that</h3>
                    <img src="../../me.avatar.jpg" class="avatar">
                
                    <img src="canicli.png" alt="">
                </section>
                <section>
                    <h2>Call to arms!</h2>
                    <div>Please open PRs to data.json</div>
                    <img src="data.png" style="border:none; background: none" alt="">
                </section>

            <section>
                <h4>Cheers! üçª</h4>

                <br><br>

                <p>@naugtur &nbsp; <a href="http://naugtur.pl/">naugtur.pl</a></p>


            </section>
            <section data-markdown>
                #### We can't have a Q&A now, but we could nerd out about the details of how the typescript hack works
            </section>


        </div>

    </div>

    <style>
        h2,
        h3 {
            margin-bottom: 0.8em !important;
        }

        #naugtur {
            background-image: none;
        }

        /*effectively switch from contain to cover behav*/
        #naugtur .slide-background video {
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
        }

        .problem .reveal {
            background-image: url('raptor.png') !important;
        }

        .sad .reveal {
            background-image: url('sad.png') !important;
        }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.5.0/lib/js/head.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.5.0/js/reveal.js"></script>

    <script>
        // Full list of configuration options available at:
        // https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            controls: true,
            progress: true,
            history: true,
            center: true,
            mouseWheel: true,

            transition: 'concave', // none/fade/slide/convex/concave/zoom

            // Parallax background image
            // parallaxBackgroundImage: '../branding/bk.jpg', // e.g. "https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg"
            //
            // // Parallax background size
            // parallaxBackgroundSize: '1920px 880px', // CSS syntax, e.g. "2100px 900px" - currently only pixels are supported (don't use % or auto)


            // Optional reveal.js plugins
            dependencies: [{
                src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.5.0/plugin/markdown/marked.js',
                condition: function () {
                    return !!document.querySelector('[data-markdown]');
                }
            }, {
                src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.5.0/plugin/markdown/markdown.js',
                condition: function () {
                    return !!document.querySelector('[data-markdown]');
                }
            }, {
                src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.5.0/plugin/highlight/highlight.js',
                async: true,
                callback: function () {
                    hljs.initHighlightingOnLoad();
                }
            }, {
                src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.5.0/plugin/zoom-js/zoom.js',
                async: true
            }, {
                src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.5.0/plugin/notes/notes.js',
                async: true
            }]
        });


        function installAnimation(icon, delay) {
            var el = document.createElement('span');
            el.classList.add('an-item');
            el.innerHTML = icon;
            an.appendChild(el)
            setTimeout(() => el.classList.add('an-to'), delay);
            return el
        }
        var an = document.querySelector('.an-container');
        Reveal.addEventListener('slidechanged', (event) => {
            console.log(event.currentSlide)
            if (event.currentSlide.classList.contains('animatedSlide')) {
                an.innerHTML = '';

                ['üîß', 'üî®', 'üî©', 'üî™', '‚ù§Ô∏è‚Äçüî•', 'üòÇ', 'üé§', 'üéµ', 'üìé', 'üíª', 'üì±', 'üìû', 'üìü', 'üì†', 'üì°', 'üì∫', 'üìª', 'üìΩ', 'üîå', 'üîã', 'üîé', 'üí°', 'üî¶', 'üî≠', 'üîÆ', 'üî∞', 'üî±', 'üïä', 'üïê', 'üïØ', 'üï∞', 'üï¥', 'üïµ', 'üï∂', 'üï∑', 'üññ', 'üñ§', 'üñ•', 'üñ¶', 'üñ®', 'üñ©', 'üñ´'].forEach((icon, index) =>
                    installAnimation(icon, index * 400)
                )
                const poo = installAnimation('üí©', 5000)
                setTimeout(() => poo.classList.add('an-oops'), 5000 + 3456)
            }


            if (event.currentSlide.classList.contains('animatedDependency')) {
                const dep = document.querySelector('.adependency');
                const deps = document.querySelector('.dependencies');
                deps.innerHTML = '';
                ' '.repeat(8).split('').forEach((_, index) => {
                    setTimeout(() => {
                        deps.appendChild(dep.cloneNode(true));
                    }, (index + 3) * 1000)
                })
            }

        })

    </script>

</body>

</html>